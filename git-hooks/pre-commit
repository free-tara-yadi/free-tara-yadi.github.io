#!/bin/bash
# Git pre-commit hook
# è‡ªåŠ¨é‡å»º content ç›®å½•çš„ JSON ç´¢å¼•æ–‡ä»¶

echo "ğŸ” Checking for content changes..."

# æ£€æŸ¥æ˜¯å¦æœ‰ content ç›®å½•ä¸‹çš„æ–‡ä»¶è¢«ä¿®æ”¹
if git diff --cached --name-only | grep -q "^content/"; then
    echo "ğŸ“ Content files detected, rebuilding indices..."
    
    # è¿è¡Œç´¢å¼•é‡å»ºè„šæœ¬
    python3 rebuild-content-index.py
    
    # æ£€æŸ¥è„šæœ¬æ˜¯å¦æˆåŠŸæ‰§è¡Œ
    if [ $? -eq 0 ]; then
        echo "âœ… Content indices updated successfully"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ç´¢å¼•æ–‡ä»¶éœ€è¦æ·»åŠ åˆ°æäº¤ä¸­
        if git diff --name-only | grep -q "\.json$"; then
            echo "ğŸ“„ Adding updated index files to commit..."
            git add content/*/*.json
        fi
    else
        echo "âŒ Failed to update content indices"
        exit 1
    fi
else
    echo "â„¹ï¸  No content changes detected, skipping index update"
fi

echo "ğŸš€ Pre-commit hook completed"
